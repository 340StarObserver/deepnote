# 需求描述 #


--------------------------------------------------


## 之前的demo版的功能 ##

账户模块  

        用户登陆，注册，注销  

笔记搜索模块  

        通过若干关键词进行搜索  
        通过书名作者名进行搜索  
        通过id进行精确搜索  

笔记管理模块  

        加载我的笔记分类和每个分类下的笔记  
        新增笔记分类  
        笔记发布  
        笔记的点赞，收藏，评论  
        我的笔记收藏  
        评论提醒  

笔记推送模块  

        加载热门的笔记推送  


--------------------------------------------------


## v1.0需求设计 ##


客户端写笔记模块  


1，实现一个单例的本地数据库管理器对象  

        封装了数据库的名称，各表的表名，数据库版本  
        每当获取连接的时候，检测库和各表是否已创建，若无则自动创建  
        只创建一次连接，重复利用，用完并不断开连接  
        能够接受草稿笔记对象或其他需要持久化的对象，并持久化（有则更新无则插入）到对应的数据表中  
        当不同的线程（包括主线程）都去使用该管理器对象的时候，需要在使用该对象的地方加入同步控制  


2，草稿笔记的封装  

        草稿笔记的属性 ： 草稿id，标题，[是否公开]，分类名，[原文出处]，[原文链接]，[引用的原文]，感受，标签们  
        其中 ： 草稿id是唯一的，可用时间戳来表示  
        其中 ： 是否公开，默认是公开的  
        其中 ： 原文出处，原文链接，引用原文默认情况下是空的  
        其中 ： 标签们默认情况下是空的字符串，若有多个标签则以逗号隔开例如"label1,label2,label3"  


3，草稿笔记的持久化  

        通过使用单例的本地数据库管理器对象来持久化到本地数据库  
        每一个草稿笔记都对应本地数据库中的一条记录  


4，查看草稿笔记列表  

        查本地数据库  
        对于每篇草稿，查出草稿id，标题，分类名，感受  
        列表中只显示每篇草稿的标题，分类名，感受的一部分  


5，进入编辑某一篇草稿笔记  

        过程如下 :  
        通过该篇草稿的草稿id，查询本地数据库，返回草稿笔记的全部属性  
        显示除了草稿id之外的所有属性  
        显示出来的各属性是可以被编辑的  


6，保存草稿  

        写笔记界面上（和草稿笔记的编辑界面是同一个界面），有按钮进行手动保存草稿  
        更新本地数据库中的对应记录  


7，手动写笔记  

        需要填写 ： 标题，[是否公开]，分类名，[原文出处]，[原文链接]，[引用的原文]，感受，标签们  
        呈现方式优雅  
        用户写笔记的时候，是不一定非要登陆的  


8，一键链接生成笔记模板  

        选中一段引用的原文，自动转到App生成笔记模板  
        若用户没有填链接 :  
        则使用引用的原文，客户端暗地里去请求百度的高级搜索，挑一个"合适的"（随机选择一个）作为链接  


9，拍照识别生成笔记模板  

        使用Cloud-OCR  
        原文链接自动填null  


--------------------------------------------------


## v1.1需求设计 ##

账户模块  


1，网络配置类的封装  

        静态单例对象  
        不需要持久化到磁盘或本地数据库（该对象不大，启动App后位于内存就行）  
        包含属性 ：  
        a. server列表，其中每一个元素都是字符串，形如 "ip:port"  
        b. 本次使用App所选用的server的下标（开始为-1，之后请求的时候检测若为-1则随机挑一个，不为-1则继续用原来的）  
        c. session_id（开始为null，登陆成功后要设置它）  
        d. token  
        这个token是重要操作的令牌，开始为-1  
        登陆成功后服务端会返回给你这个值，它是一个随机数，之后进行重要操作需要在请求中带上它  
        且它是一次一密的，用完后服务端会返回给你一个新的token，你需要更新它  
        若服务端返回token验证错误，则你需要重新输入密码登陆  


2，注册  

        需要用户名，密码，头像  
        若使用用户自己上传的头像，则需要提交前在客户端等比例缩小到一定尺寸，并且提供缩小后的预览功能  
        若使用系统默认头像，则不需要缩小（因为默认头像本身足够小）  
        一次性提交所有数据  
        密码提交前要转化为md5-32位的密文  

        主线程要等待这个注册请求的线程  
        注册成功后，先提示注册成功，然后倒计时几秒钟，再自动登陆  
        采用邀请码的方式，且注册成功后用户自动拥有邀请码（也就拥有了邀请别人的权利）  


3，个人基本信息类的封装  

        静态单例对象  
        该类包含　：　用户名，加密密码，头像（头像图片在本地文件系统中的地址），邀请码  
        其中，头像图片在注册成功后，就要保存到文件系统中的指定地方   
        通过使用单例的数据库管理器对象，持久化到本地数据库  
        通过使用单例的数据库管理器对象，从本地数据库读取数据并创建个人基本信息对象并返回  

4，用户登陆  

        第一次登陆，发送请求之前，就要创建个人基本信息的单例对象（用以在界面跳转之间暂存数据）  
        主线程要等待这个登陆请求的线程  
        
        第一次登陆后 :  
        根据服务端传来的数据，更新内存中的个人基本信息对象  
        更新内存中的网络配置类对象中的session_id和token  
        把个人信息持久化到本地数据库  
        
        之后登陆，都是先从本地数据库读取数据，创建单例的个人基本信息对象，再自动检测网络是否通畅 :  
        若网络通畅，则利用个人基本信息对象中的属性进行自动登陆  
        若网络不通畅，则不发送登陆请求，并进入个人主页显示本地已有的笔记，并提示网络不通  
        
        用户在登陆后，可以进行删除本地的个人数据的操作  
        那样的话，本地的所有个人数据（包括个人基本数据,笔记草稿数据，笔记数据）都会被删除  
        且下次需要手动输入账号密码  
        
        在等待登陆结果的时候，显示该用户的头像和用户名，不要什么都没有干等着  


3，用户注销  

        手动注销的时候，提示用户是否删除本地个人数据  


--------------------------------------------------


## v1.2需求设计 ##

笔记管理模块  


1，已发布笔记类（不同于草稿笔记类）的封装  

        包含的属性 ：  
            笔记id，标题，作者用户名，发布时间，是否公开，所属分类名  
            引用文章的出处，引用文章的链接，引用文段，个人感悟  
            标签列表，认同数，反对数，评论数，收藏数，评论列表  
        其中，评论类的封装（评论编号，父评论编号，评论时间，评论者用户名，评论者的头像链接地址，评论内容）  
        
        能够持久化 :  
        通过使用单例的数据库管理器对象来持久化到本地数据库  
        本地数据库中，已发布笔记表和草稿笔记表是不同的表  
        
        能够恢复 :  
        通过使用单例的数据库管理器对象，通过笔记id来查询本地数据库，使用查到的数据构造出一个已发布笔记对象，并返回  
        
        首次登陆成功后，发送加载个人笔记的请求（主线程等待该请求线程），播放一个加载动画  
        收到响应数据后，把所有已发布笔记的详细数据，一次性批量更新到本地数据库  
        然后停止动画，并转入个人主页  


2，查看自己某分类下的笔记列表  

        不需要登陆  
        不发送请求，直接查本地数据库  
        对于每篇笔记，显示（标题，发布时间，是否公开，发布时间，个人感悟的一部分，标签们）  
        按照发布时间降序排列  


3，查看自己某分类下的某一篇笔记的具体内容  

        不需要登陆  
        不发送请求，使用单例的本地数据库管理器对象，传入笔记id来查询本地数据库  
        显示 :  
        标题，发布时间，是否公开，所属分类名  
        引用文章的出处，引用文章的链接，引用文段  
        个人感悟，标签列表，认同数，反对数，收藏数，全部评论  


4，同步自己的笔记  

        点击同步后 ：  
        自动检测是否已登陆（通过查看单例的网络配置对象中的session_id）  
        若没有登陆，则在当前界面弹出一个登陆框，登陆成功后登陆框消失，并自动发送同步请求  
        
        主线程要等待这个同步请求的线程  
        该请求需要带上token  
        
        接收到服务端的响应后，更新本地数据库中的全部已发布笔记的内容  


5，笔记的发布  

        点击提交后 :  
        自动检测是否已登陆（通过查看单例的网络配置对象中的session_id）  
        若没有登陆，则在当前界面上弹出一个登陆框，登陆成功后该登陆框消失，并自动发起网络请求  
        
        主线程要等待这个发布请求的线程  
        该请求需要带上token  
        
        收到服务端的响应后，若发布成功 :  
        把该篇笔记插入到本地数据库的已发布笔记table中  
        并删除本地数据库中的草稿笔记table中的对应记录  


6，笔记的更新  

        在查看自己的某篇笔记的界面（查看自己的笔记不需要登陆，因为本地数据库里就有），有个编辑按钮  
        可以修改 ： 笔记标题，是否公开，分类名，个人感悟，标签们  
        
        点击保存后 :  
        自动检测是否已登陆（通过查看单例的网络配置对象中的session_id）  
        若没有登陆，则在当前界面上弹出一个登陆框，登陆成功后该登陆框消失，并自动发起网络请求  
        
        主线程要等待这个更新请求的线程  
        该请求需要带上token  
        
        收到服务端的响应后，若保存成功 :  
        更新当前界面上的显示  
        更新本地数据库中已发布笔记table中对应的记录  


7，笔记的删除  

        在查看自己的某篇笔记的界面（查看自己的笔记不需要登陆，因为本地数据库里就有），有个删除按钮  
        
        点击删除后 :  
        自动检测是否已登陆（通过查看单例的网络配置对象中的session_id）  
        若没有登陆，则在当前界面上弹出一个登陆框，登陆成功后该登陆框消失，并自动发起网络请求  
        
        主线程要等待这个删除请求的线程  
        该请求需要带上token  
        
        收到服务端的响应后，若删除成功 :  
        删除本地数据库中已发布笔记table中对应的记录  
        然后转到个人主页  


8，笔记的收藏  

        在精确搜索某篇笔记后，展示那篇笔记具体内容的界面上，有用来收藏的按钮  
        
        点击收藏后 :  
        自动检测是否已登陆（通过查看单例的网络配置对象中的session_id）  
        若没有登陆，则在当前界面上弹出一个登陆框，登陆成功后该登陆框消失，并自动发起网络请求  
        
        主线程要等待这个收藏请求的线程  
        
        收到服务端的响应后，若收藏成功 :  
        通过数据库管理器对象，将这篇读书笔记插入到本地数据库的笔记收藏表中  
        只记录（笔记id，标题，所属用户的用户名，所属用户的头像链接，发布时间，标签们，感受的一部分）  


9，查看我收藏的笔记列表  

        不需要登陆  
        不发送请求，使用单例的本地数据库管理器对象，查询本地数据库中的笔记收藏表  
        显示除了笔记id之外的所有信息  


10，笔记的点赞，反对，评论  

        在精确搜索某篇笔记后，展示那篇笔记具体内容的界面上，有用来点赞，反对，评论的按钮  
        
        点击点赞 or 反对 or 评论（事先输入内容）后 :  
        自动检测是否已登陆（通过查看单例的网络配置对象中的session_id）  
        若没有登陆，则在当前界面上弹出一个登陆框，登陆成功后该登陆框消失，并自动发起网络请求  
        
        发起请求后（即启动该请求所需的线程后） :  
        立即更新界面上的显示  
        不用等待该线程  


11，手动获取最新消息  

        提供按钮，能够让用户手动去发起请求获取最新消息  
        
        点击按钮后 :  
        自动检测是否已登陆（通过查看单例的网络配置对象中的session_id）  
        若没有登陆，则在当前界面上弹出一个登陆框，登陆成功后该登陆框消失，并自动发起网络请求  
        
        主线程需要等待这个手动获取最新消息请求的线程  
        
        可以不断往下下拉翻页  


12，顺带获取最新消息  

        意思是说，在进行某些其他请求的时候，服务端会顺带地把和用户相关的最新的消息返回  
        
        客户端在进行某些其他请求的时候，每收到顺带返回的评论 :  
        要点亮某个图标，好让用户知道有最新的消息了  


--------------------------------------------------


## v2.0需求设计 ##

笔记搜索模块  

1，分页浏览所有笔记  

        按时间分页降序查询  
        对于每篇笔记，获取 : 笔记id，标题，主人用户名，主人头像链接，发布时间，感悟，标签们  
        展示除了笔记id之外的所有信息  


2，根据若干关键词搜索读书笔记  

        对于每一篇足够匹配的读书笔记，返回它的（笔记id，标题，标签们，主人用户名，主人头像链接，发布时间，感受，热度）  
        
        搜索结果根据匹配程度和热度，降序排列  
        第一个关键词的权重最大  
        支持分页查询  
        不需要登陆  
        没有查到的时候，也有一个比较优雅的反馈  
        搜索速度必须优化，但目前对具体数字指标还没底  
        
        用户输入多个关键词时的体验要好  
        搜索结果优雅呈现  


3，根据书名来搜索读书笔记  

        对于每一篇足够匹配的读书笔记，需要返回它的（笔记id，标题，标签们，主人用户名，主人头像链接，发布时间，感受，热度）  
        
        搜索结果根据匹配程度和热度，降序排列  
        支持分页查询  
        不需要登陆  
        
        可以手动搜索，用户输入书名的时候体验要好  
        可以自动搜索，即用户在看某一篇笔记的详细信息的那个页面上，可以点个按钮自动以该篇笔记的书名来搜索  
        
        搜索结果优雅呈现  
        没有查到的时候，也有一个比较优雅的反馈  
        搜索速度必须优化，但目前对具体数字指标还没底  


4，根据读书笔记的id来搜索读书笔记  

        返回这篇读书笔记的 :  
        笔记id，标题，作者，发布时间，引用文章的出处，引用文章的链接，引用文段  
        感受，标签们，认同数，反对数，评论数，收藏数，全部评论内容  
        
        不需要登陆  
        笔记内容优雅呈现  
        没有查到的时候，也有一个比较优雅的反馈  


--------------------------------------------------


## v3.0需求设计 ##

笔记推送模块  

1，笔记的公共推送  

        公共推送是分几个大类的  
        
        进入某一类，看到的是笔记列表，对于每篇笔记 :  
        获取的是（笔记id，标题，标签们，主人用户名，主人头像链接，发布时间，感受）  
        显示的是除了笔记id之外的信息  
        
        公共推送每两天更新一次，且推送的是一周内的各分类下的热门笔记  
        推送需要能够有效过滤掉那种明显是水军刷出来的  
        获取公共推送不需要登陆  

